
> <details>
> <summary>âš ï¸ Outside diff range comments (7)</summary><blockquote>
> 
> <details>
> <summary>src/app/[locale]/usage-doc/page.tsx (1)</summary><blockquote>
> 
> `816-840`: **ç§»é™¤é‡å¤çš„ `configPath` å£°æ˜ï¼›è¡¥å……ç¼ºå¤±çš„å›½é™…åŒ–ç¿»è¯‘ keyï¼›ä¿®æ­£ JSON ä»£ç å—è¯­è¨€æ ‡ç­¾**
> 
> ä»¥ä¸‹é—®é¢˜éœ€è¦ç«‹å³ä¿®å¤ï¼š
> 
> 1. **åˆ é™¤é‡å¤å£°æ˜**ï¼ˆç¬¬ 816ã€818 è¡Œï¼‰ï¼šå¯¹ `configPath` çš„ `const` å£°æ˜å®Œå…¨ç›¸åŒï¼Œä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚ä¿ç•™ä¸€æ¡å³å¯ã€‚
> 
> 2. **è¡¥å……ç¼ºå¤±çš„ç¿»è¯‘ key**ï¼šä»£ç åœ¨ç¬¬ 825 è¡Œè°ƒç”¨ `t("claudeCode.vsCodeExtension.configPath", { path: configPath })`ï¼Œä½†æ£€æŸ¥ `messages/zh-CN/usage.json` å‘ç°è¯¥ key ä¸å­˜åœ¨ï¼ˆåªæœ‰ `title`ã€`steps`ã€`note`ã€`notePoints`ï¼‰ã€‚éœ€è¦åœ¨æ‰€æœ‰è¯­è¨€æ–‡ä»¶çš„ `claudeCode.vsCodeExtension` å¯¹è±¡ä¸­æ·»åŠ è¯¥ keyï¼Œä¾‹å¦‚ï¼š
>    ```json
>    "configPath": "é…ç½®æ–‡ä»¶è·¯å¾„ï¼š{path}"
>    ```
> 
> 3. **ä¿®æ­£ä»£ç å—è¯­è¨€æ ‡ç­¾**ï¼ˆç¬¬ 835 è¡Œï¼‰ï¼šå½“å‰æ ‡è®°ä¸º `language="json"`ï¼Œä½†ä»£ç å—åŒ…å« `// Path: ...` æ³¨é‡Šã€‚ä¸¥æ ¼ JSON ä¸æ”¯æŒæ³¨é‡Šã€‚æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š
>    - å¦‚æœ Claude Code çš„é…ç½®æ ¼å¼ç¡®å®æ”¯æŒæ³¨é‡Šï¼ˆç±»ä¼¼ JSONCï¼‰ï¼Œæ”¹ä¸º `language="jsonc"`
>    - å¦‚æœä¸æ”¯æŒï¼Œæ”¹ä¸ºçº¯ JSONï¼Œå°†è·¯å¾„æ³¨é‡Šç§»åˆ°ä»£ç å—å¤–çš„è¯´æ˜æ–‡å­—ä¸­
> 
> 4. **linux è·¯å¾„å¤„ç†**ï¼ˆç¬¬ 816 è¡Œï¼‰ï¼š`config.configPath` ä»…å®šä¹‰äº† `macos` å’Œ `windows` æ¡ç›®ã€‚å½“ `os === "linux"` æ—¶ä¼šé”™è¯¯åœ°ä½¿ç”¨ Windows è·¯å¾„ã€‚å¦‚æœæ‰©å±•åœ¨ Linux ä¸Šæœ‰ç‹¬ç«‹è·¯å¾„ï¼Œåº”åœ¨é…ç½®ä¸­æ·»åŠ  `linux` æ¡ç›®ï¼Œå¹¶æ›´æ–°é€‰æ‹©é€»è¾‘ã€‚
> 
> </blockquote></details>
> <details>
> <summary>src/app/[locale]/dashboard/_components/user/forms/add-key-form.tsx (1)</summary><blockquote>
> 
> `26-37`: **è€ƒè™‘ä¸º add-key-form ä¸­çš„ `dailyResetMode` æ·»åŠ  UI æ§åˆ¶ï¼Œä»¥åŒ¹é… provider-form çš„åŠŸèƒ½ã€‚**
> 
> æ ¹æ®ä»£ç åº“éªŒè¯ï¼Œç³»ç»Ÿæ¶æ„æ”¯æŒä¸¤ç§æ—¥é™é¢é‡ç½®æ¨¡å¼ï¼š"fixed"ï¼ˆå›ºå®šçª—å£ï¼‰å’Œ "rolling"ï¼ˆæ»šåŠ¨çª—å£ï¼‰ã€‚åœ¨ provider-form ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ UI é€‰æ‹©å™¨é…ç½® `dailyResetMode`ï¼›ä½†åœ¨ add-key-form ä¸­ï¼Œè¯¥å­—æ®µè¢«ç¡¬ç¼–ç ä¸º "fixed"ï¼Œç”¨æˆ·æ— æ³•é€‰æ‹©ã€‚å»ºè®®åœ¨ add-key-form ä¸­æ·»åŠ ç›¸åŒçš„ UI é€‰æ‹©å™¨ï¼Œä»¥ä¿æŒåŠŸèƒ½ä¸€è‡´æ€§ã€‚
> 
> </blockquote></details>
> <details>
> <summary>src/repository/key.ts (1)</summary><blockquote>
> 
> `11-36`: **Key ä»“å‚¨è¯»è·¯å¾„ç¼ºå°‘ dailyResetModeï¼Œå¯èƒ½å¯¼è‡´æ—¥é™é¢æ¨¡å¼åˆ¤æ–­å¤±æ•ˆ**
> 
> - åœ¨å†™å…¥è·¯å¾„ä¸Šï¼š
>   - `createKey` å·²æ­£ç¡®å°† `limit_daily_usd`ã€`daily_reset_mode`ã€`daily_reset_time` å†™å…¥æ•°æ®åº“ï¼Œå¹¶åœ¨ `returning` ä¸­åŒ…å«äº† `dailyResetMode`/`dailyResetTime`ã€‚
>   - `updateKey` ä¹Ÿæ”¯æŒæ›´æ–°è¿™ä¸‰ä¸ªå­—æ®µï¼ˆç»„è£…åˆ° `dbData` ä¸­ï¼‰ã€‚
> - ä½†åœ¨**è¯»å–è·¯å¾„**ä¸Šï¼Œå¤šå¤„åªè¿”å›äº† `dailyResetTime` è€Œæ²¡æœ‰è¿”å› `dailyResetMode`ï¼š
>   - `findKeyById` / `findKeyList` / `findActiveKeyByUserIdAndName` / `findActiveKeyByKeyString` çš„ `select` ä¸­ï¼Œä»…æ–°å¢äº† `limitDailyUsd` ä¸ `dailyResetTime`ã€‚
>   - `updateKey` çš„ `returning` åŒæ ·é—æ¼äº† `dailyResetMode`ã€‚
>   - `validateApiKeyAndGetUser` é‡Œ Key ç›¸å…³é€‰å–å­—æ®µä¹Ÿåªæœ‰ `keyDailyResetTime`ï¼Œæ²¡æœ‰ `keyDailyResetMode`ã€‚
> - ç”±äº `Key` ç±»å‹ç°åœ¨è¦æ±‚ `dailyResetMode: "fixed" | "rolling"`ï¼Œè€Œè¿™äº›æŸ¥è¯¢éƒ½é€šè¿‡ `toKey` æ„é€ æœ€ç»ˆçš„ `Key` å¯¹è±¡ï¼Œå¦‚æœç¼ºå¤±è¯¥å­—æ®µï¼Œå¾ˆå®¹æ˜“åœ¨è¿è¡Œæ—¶å¾—åˆ° `undefined` çš„ `dailyResetMode`ï¼Œä»è€Œè®©æ—¥é™é¢é€»è¾‘æ— æ³•åŒºåˆ†å›ºå®šçª—å£ä¸æ»šåŠ¨çª—å£ï¼ˆå°¤å…¶æ˜¯åœ¨é‰´æƒåè¿›è¡Œé™æµåˆ¤æ–­çš„è·¯å¾„ä¸­ï¼‰ã€‚
> 
> å»ºè®®åœ¨æ‰€æœ‰è¿”å› `limitDailyUsd`/`dailyResetTime` çš„åœ°æ–¹ï¼Œä¸€å¹¶è¡¥é½ `dailyResetMode`ï¼Œä¾‹å¦‚ï¼š
> 
> ```diff
> // findKeyById / findKeyList ç­‰ select å½¢å¦‚ï¼š
> -      limit5hUsd: keys.limit5hUsd,
> -      limitDailyUsd: keys.limitDailyUsd,
> -      dailyResetTime: keys.dailyResetTime,
> +      limit5hUsd: keys.limit5hUsd,
> +      limitDailyUsd: keys.limitDailyUsd,
> +      dailyResetMode: keys.dailyResetMode,
> +      dailyResetTime: keys.dailyResetTime,
> ```
> 
> ```diff
> // updateKey returning:
> -      limit5hUsd: keys.limit5hUsd,
> -      limitDailyUsd: keys.limitDailyUsd,
> -      dailyResetTime: keys.dailyResetTime,
> +      limit5hUsd: keys.limit5hUsd,
> +      limitDailyUsd: keys.limitDailyUsd,
> +      dailyResetMode: keys.dailyResetMode,
> +      dailyResetTime: keys.dailyResetTime,
> ```
> 
> ```diff
> // validateApiKeyAndGetUser ä¸­ key* å­—æ®µï¼š
> -      keyLimit5hUsd: keys.limit5hUsd,
> -      keyLimitDailyUsd: keys.limitDailyUsd,
> -      keyDailyResetTime: keys.dailyResetTime,
> +      keyLimit5hUsd: keys.limit5hUsd,
> +      keyLimitDailyUsd: keys.limitDailyUsd,
> +      keyDailyResetMode: keys.dailyResetMode,
> +      keyDailyResetTime: keys.dailyResetTime,
> ```
> 
> å¹¶åœ¨æ„é€  `Key` æ—¶å°† `keyDailyResetMode` ä¼ å…¥ `toKey`ã€‚è¿™æ ·æ‰èƒ½ç¡®ä¿æ‰€æœ‰å…¥å£æ‹¿åˆ°çš„ `Key` å¯¹è±¡éƒ½åŒ…å«å®Œæ•´çš„æ—¥é™é¢é…ç½®ï¼Œé¿å… rolling/fixed æ¨¡å¼åˆ¤æ–­å‡ºé”™ã€‚
> 
> 
> 
> 
> Also applies to: 38-63, 83-101, 112-135, 135-156, 166-198, 255-273, 292-371
> 
> </blockquote></details>
> <details>
> <summary>src/lib/validation/schemas.ts (1)</summary><blockquote>
> 
> `61-78`: **UpdateProviderSchema ç¼ºå°‘ daily_reset_mode å­—æ®µï¼Œå¯¼è‡´æ— æ³•æ›´æ–°æ—¥é‡ç½®æ¨¡å¼**
> 
> éªŒè¯ç»“æœç¡®è®¤äº†æ­¤é—®é¢˜ã€‚åœ¨ CreateProviderSchema ç¬¬ 151 è¡Œå®šä¹‰äº† `daily_reset_mode` å­—æ®µï¼Œä½† UpdateProviderSchemaï¼ˆç¬¬ 245-260 è¡Œï¼‰ä¸­å®Œå…¨ç¼ºå°‘è¯¥å­—æ®µã€‚è¿™ä¼šå¯¼è‡´å‰ç«¯å‘é€çš„è¯¥å­—æ®µè¢« Zod schema éªŒè¯æ—¶å¿½ç•¥ï¼Œä»è€Œæ— æ³•é€šè¿‡æ›´æ–°æ¥å£ä¿®æ”¹æ—¥é‡ç½®æ¨¡å¼ï¼Œäº§ç”ŸåŠŸèƒ½ç¼ºé™·ã€‚
> 
> å»ºè®®åœ¨ UpdateProviderSchema ä¸­è¡¥å……ï¼š
> 
> ```diff
>   limit_daily_usd: z.coerce
>     .number()
>     .min(0, "æ¯æ—¥æ¶ˆè´¹ä¸Šé™ä¸èƒ½ä¸ºè´Ÿæ•°")
>     .max(10000, "æ¯æ—¥æ¶ˆè´¹ä¸Šé™ä¸èƒ½è¶…è¿‡10000ç¾å…ƒ")
>     .nullable()
>     .optional(),
> + daily_reset_mode: z.enum(["fixed", "rolling"]).optional(),
>   daily_reset_time: z
>     .string()
>     .regex(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/, "é‡ç½®æ—¶é—´æ ¼å¼å¿…é¡»ä¸º HH:mm")
>     .optional(),
> ```
> 
> ä¿æŒåˆ›å»ºå’Œæ›´æ–°è·¯å¾„å¯¹æ—¥é‡ç½®æ¨¡å¼çš„å¤„ç†ä¸€è‡´ã€‚
> 
> </blockquote></details>
> <details>
> <summary>src/actions/keys.ts (1)</summary><blockquote>
> 
> `241-299`: **getKeyLimitUsage æœªä¼ é€’ dailyResetModeï¼Œrolling æ—¥é™é¢å±•ç¤ºä¸å®é™…é™æµçª—å£ä¼šä¸ä¸€è‡´**
> 
> `getKeyLimitUsage` å½“å‰çš„å®ç°ï¼š
> 
> - æŸ¥è¯¢ daily æˆæœ¬æ—¶è°ƒç”¨ï¼š
>   ```ts
>   RateLimitService.getCurrentCost(keyId, "key", "daily", key.dailyResetTime)
>   ```
>   æ²¡æœ‰æŠŠ `key.dailyResetMode` ä¼ è¿›å»ï¼Œå› è€Œ `getCurrentCost` æ€»æ˜¯æŒ‰é»˜è®¤ `"fixed"` æ¨¡å¼èµ°ã€‚
> - å±•ç¤ºé‡ç½®ä¿¡æ¯æ—¶è°ƒç”¨ï¼š
>   ```ts
>   const resetInfoDaily = getResetInfo("daily", key.dailyResetTime);
>   ```
>   åŒæ ·å¿½ç•¥äº†æ¨¡å¼ã€‚å¯¹äº rolling æ¨¡å¼ï¼Œæœ¬åº”ä½¿ç”¨ 24 å°æ—¶æ»šåŠ¨çª—å£è¯­ä¹‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå›ºå®šçš„ `resetAt` æ—¶é—´ç‚¹ã€‚
> 
> è¿™ä¼šå¯¼è‡´ä¸€æ—¦æŸä¸ª Key çš„æ—¥é™é¢é…ç½®ä¸º rollingï¼š
> 
> - çœŸæ­£çš„é™æµåˆ¤æ–­ï¼ˆ`checkCostLimits` / `trackCost`ï¼‰ä¼šä½¿ç”¨ rolling é€»è¾‘ï¼›
> - ä½†ç®¡ç†ç«¯çœ‹åˆ°çš„ `costDaily.current` ä¸ã€Œé‡ç½®æ—¶é—´ã€ä»ç„¶æ˜¯æŒ‰ fixed è®¡ç®—ï¼Œå±•ç¤ºä¸å®é™…è¡Œä¸ºè„±èŠ‚ã€‚
> 
> å»ºè®®æœ€å°æ”¹åŠ¨å¦‚ä¸‹ï¼š
> 
> ```diff
> -    const { getResetInfo } = await import("@/lib/rate-limit/time-utils");
> +    const { getResetInfoWithMode } = await import("@/lib/rate-limit/time-utils");
> ...
> -      RateLimitService.getCurrentCost(keyId, "key", "daily", key.dailyResetTime),
> +      RateLimitService.getCurrentCost(
> +        keyId,
> +        "key",
> +        "daily",
> +        key.dailyResetTime,
> +        key.dailyResetMode ?? "fixed"
> +      ),
> ...
> -    const resetInfoDaily = getResetInfo("daily", key.dailyResetTime);
> +    const resetInfoDaily = getResetInfoWithMode(
> +      "daily",
> +      key.dailyResetTime,
> +      key.dailyResetMode ?? "fixed"
> +    );
> ```
> 
> å½“å‰ `costDaily.resetAt` ç±»å‹æ˜¯å¯é€‰çš„ï¼ˆ`resetAt?: Date`ï¼‰ï¼Œå³ä¾¿ rolling æ¨¡å¼ä¸‹ `resetAt` ä¸º `undefined` ä¹Ÿä¸ä¼šç ´åç±»å‹çº¦æŸï¼Œå‰ç«¯å¯ä»¥é€šè¿‡ `resetInfoDaily.type === "rolling"` æˆ– `!resetAt` æ¥åŒºåˆ†å±•ç¤ºã€‚
> 
> </blockquote></details>
> <details>
> <summary>src/repository/provider.ts (1)</summary><blockquote>
> 
> `11-49`: **repository å±‚æ²¡æœ‰é€‰å‡º dailyResetModeï¼Œå¯¼è‡´ä¸Šå±‚æ‹¿ä¸åˆ°çœŸå®æ—¥é™é¢æ¨¡å¼**
> 
> è¿™é‡Œè™½ç„¶åœ¨ `createProvider` / `updateProvider` çš„ `dbData` ä¸­å·²ç»å†™å…¥äº†ï¼š
> 
> - `limitDailyUsd`
> - `dailyResetMode`
> - `dailyResetTime`
> 
> ä½†åœ¨æ‰€æœ‰æŸ¥è¯¢ / returning ä¸­ï¼š
> 
> - `createProvider` çš„ `.returning({ ... })` åªåŒ…å« `limitDailyUsd` å’Œ `dailyResetTime`ï¼Œæ²¡æœ‰ `dailyResetMode`ï¼›
> - `findProviderList` çš„ `.select({ ... })` ä¹Ÿæ˜¯ `limitDailyUsd` + `dailyResetTime`ï¼Œæ²¡æœ‰ `dailyResetMode`ï¼›
> - `findProviderById` ä¸ `updateProvider` çš„ `.returning({ ... })` åŒæ ·ç¼ºå¤± `dailyResetMode`ã€‚
> 
> ä¸æ­¤åŒæ—¶ï¼Œä¸Šå±‚ä»£ç ï¼ˆä¾‹å¦‚ `src/actions/providers.ts` ä¸­çš„ `getProviders` / `getProviderLimitUsage`ã€ä»¥åŠé™æµç›¸å…³é€»è¾‘ï¼‰å·²ç»åœ¨è®¿é—® `provider.dailyResetMode` å­—æ®µï¼Œè¿™åœ¨å½“å‰å®ç°ä¸‹ææœ‰å¯èƒ½å§‹ç»ˆä¸º `undefined`ï¼Œä½¿å¾—ï¼š
> 
> - rolling æ¨¡å¼é…ç½®ï¼ˆå³ä¾¿æ•°æ®åº“ä¸­æœ‰å€¼ï¼‰ä¹Ÿä¸ä¼šè¢«çœŸæ­£è¯»å‡ºä½¿ç”¨ï¼›
> - æ‰€æœ‰è°ƒç”¨å¤„éƒ½ä¼šé€€å›åˆ°é»˜è®¤ `"fixed"` æ¨¡å¼ã€‚
> 
> å»ºè®®ï¼š
> 
> - åœ¨æ‰€æœ‰ç›¸å…³ select/returning ä¸­è¡¥é½ `dailyResetMode` å­—æ®µï¼Œä¾‹å¦‚ï¼š
> 
> ```diff
> // createProvider
> -    limit5hUsd: providers.limit5hUsd,
> -    limitDailyUsd: providers.limitDailyUsd,
> -    dailyResetTime: providers.dailyResetTime,
> +    limit5hUsd: providers.limit5hUsd,
> +    limitDailyUsd: providers.limitDailyUsd,
> +    dailyResetMode: providers.dailyResetMode,
> +    dailyResetTime: providers.dailyResetTime,
> ```
> 
> - åŒæ ·åœ¨ `findProviderList`ã€`findProviderById`ã€`updateProvider` çš„è¿”å›æ˜ å°„ä¸­åŠ å…¥ `dailyResetMode`ã€‚
> 
> è¿™æ · `toProvider` å’Œä¸Šå±‚é€»è¾‘æ‰èƒ½æ‹¿åˆ°æ­£ç¡®çš„æ¨¡å¼å€¼ï¼Œrolling æ¨¡å¼æ‰èƒ½çœŸæ­£ç”Ÿæ•ˆã€‚  
> 
> 
> 
> Also applies to: 51-86, 95-131, 147-189, 191-297
> 
> </blockquote></details>
> <details>
> <summary>src/actions/providers.ts (1)</summary><blockquote>
> 
> `109-149`: **ä¾›åº”å•† daily é™é¢å±•ç¤ºæœªè€ƒè™‘ dailyResetModeï¼Œrolling æ¨¡å¼ä¸‹ä¼šä¸å®é™…è¡Œä¸ºä¸ä¸€è‡´**
> 
> åœ¨ä¾›åº”å•†ä¾§ç›®å‰å­˜åœ¨å‡ å¤„ä¸ä¸€è‡´ / ä¸å®Œæ•´çš„åœ°æ–¹ï¼š
> 
> 1. **`getProviders` æ˜ å°„ï¼š**
>    - è¿™é‡ŒæŠŠ `provider.dailyResetMode` é€ä¼ ç»™å‰ç«¯ï¼Œä½†å¦‚åœ¨ `src/repository/provider.ts` ä¸­æ‰€è§ï¼Œrepository å±‚å¹¶æœªä»æ•°æ®åº“ select è¯¥åˆ—ï¼Œä¸Šå±‚æ‹¿åˆ°çš„å¤šåŠæ˜¯ `undefined`ï¼ˆå·²åœ¨è¯¥æ–‡ä»¶è¯„è®ºä¸­æŒ‡å‡ºï¼‰ã€‚
>    - ä¿®å¤ repository åï¼Œè¿™é‡Œå¯ä»¥æ­£å¸¸å±•ç¤º fixed/rolling æ¨¡å¼ã€‚
> 
> 2. **`getProviderLimitUsage` æ²¡æœ‰ä¼ å…¥ dailyResetModeï¼š**
>    - å½“å‰è°ƒç”¨ï¼š
>      ```ts
>      RateLimitService.getCurrentCost(providerId, "provider", "daily", provider.dailyResetTime)
>      ```
>      æœªä¼  `provider.dailyResetMode`ï¼Œ`getCurrentCost` ä¼šå§‹ç»ˆæŒ‰é»˜è®¤ `"fixed"` æ¨¡å¼å¤„ç† dailyã€‚
>    - é‡ç½®ä¿¡æ¯ä¹Ÿåªç”¨äº†ï¼š
>      ```ts
>      const resetDaily = getResetInfo("daily", provider.dailyResetTime);
>      ```
>      å¿½ç•¥äº†æ¨¡å¼ï¼›rolling æ¨¡å¼æœ¬åº”ä½¿ç”¨ 24 å°æ—¶æ»šåŠ¨è¯­ä¹‰ï¼Œè€Œä¸æ˜¯å›ºå®š `resetAt`ã€‚
> 
> 3. **è¿”å›ç±»å‹å¯¹ rolling ä¸å‹å¥½ï¼š**
>    - `costDaily` ç›®å‰å®šä¹‰ä¸ºï¼š
>      ```ts
>      costDaily: { current: number; limit: number | null; resetAt: Date };
>      ```
>    - è€Œ `time-utils` ä¸­ rolling daily çš„ `ResetInfo` æ˜¯ `{ type: "rolling", period: "24 å°æ—¶" }`ï¼Œæ²¡æœ‰ `resetAt` æ¦‚å¿µã€‚å¦‚æœæœªæ¥æ”¯æŒ rolling dailyï¼Œè¿™é‡Œçš„ç±»å‹å’Œè¯­ä¹‰éƒ½éœ€è¦è°ƒæ•´ã€‚
> 
> å»ºè®®æ–¹å‘ï¼ˆä¸ Key ç«¯ä¿æŒä¸€è‡´ï¼‰ï¼š
> 
> - è°ƒç”¨ `RateLimitService.getCurrentCost` æ—¶æ˜¾å¼ä¼ å…¥æ¨¡å¼ï¼š
>   ```diff
>   const [cost5h, costDaily, costWeekly, costMonthly, concurrentSessions] = await Promise.all([
>     RateLimitService.getCurrentCost(providerId, "provider", "5h"),
> -   RateLimitService.getCurrentCost(providerId, "provider", "daily", provider.dailyResetTime),
> +   RateLimitService.getCurrentCost(
> +     providerId,
> +     "provider",
> +     "daily",
> +     provider.dailyResetTime,
> +     provider.dailyResetMode ?? "fixed"
> +   ),
>     ...
>   ]);
>   ```
> 
> - è‹¥è¦åœ¨å‰ç«¯æ­£ç¡®å±•ç¤º rolling ä¸ fixedï¼Œå»ºè®®ï¼š
>   - æŠŠ `costDaily.resetAt` æ”¹ä¸ºå¯é€‰ï¼ˆ`resetAt?: Date`ï¼‰ï¼Œå¹¶åœ¨ rolling æ¨¡å¼ä¸‹åªæä¾› `type: "rolling" + period` çš„æè¿°ï¼ˆé€šè¿‡ `getResetInfoWithMode`ï¼‰ï¼Œä¸å¡« `resetAt`ã€‚
>   - æˆ–è€…åœ¨è¿”å›ä¸­é¢å¤–å¢åŠ ä¸€ä¸ª `resetInfo` å­—æ®µï¼Œå‰ç«¯ä¾æ® `ResetInfo.type` æ¥å†³å®šæ˜¾ç¤ºã€Œ24 å°æ—¶æ»šåŠ¨çª—å£ã€è¿˜æ˜¯å…·ä½“æ—¥æœŸæ—¶é—´ã€‚
> 
> è¿™æ ·ä¾›åº”å•† daily é™é¢çš„å±•ç¤ºæ‰èƒ½ä¸ RateLimitService ä¸­å·²å®ç°çš„ fixed/rolling è¡Œä¸ºä¿æŒä¸€è‡´ã€‚  
> 
> 
> 
> 
> Also applies to: 164-196, 238-259, 295-328, 524-587
> 
> </blockquote></details>
> 
> </blockquote></details>

<details>
<summary>ğŸ§¹ Nitpick comments (12)</summary><blockquote>

<details>
<summary>src/lib/hooks/use-format-currency.ts (1)</summary><blockquote>

`46-46`: **æ”¹è¿›äº†å¯è§‚æµ‹æ€§ï¼Œå˜æ›´çœ‹èµ·æ¥ä¸é”™ï¼**

æ·»åŠ  console.warn å¯ä»¥å¸®åŠ©åœ¨è´§å¸æ ¼å¼åŒ–å¤±è´¥å¹¶ä½¿ç”¨å›é€€é€»è¾‘æ—¶è¿›è¡Œè°ƒè¯•å’Œç›‘æ§ã€‚æ—¥å¿—æ¶ˆæ¯æ¸…æ™°æè¿°äº†å‘ç”Ÿçš„æƒ…å†µï¼Œè®°å½•é”™è¯¯å¯¹è±¡å¯¹äºæ’æŸ¥é—®é¢˜å¾ˆæœ‰å¸®åŠ©ã€‚



å¦‚æœé¡¹ç›®æœªæ¥æ‰©å±•å¯è§‚æµ‹æ€§åŸºç¡€è®¾æ–½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—æœåŠ¡æ›¿ä»£ console.warnï¼Œä½†å¯¹äºå®¢æˆ·ç«¯ä»£ç æ¥è¯´ï¼Œå½“å‰çš„å®ç°æ˜¯å®Œå…¨åˆé€‚çš„ã€‚

</blockquote></details>
<details>
<summary>src/lib/utils/zod-i18n.ts (1)</summary><blockquote>

`59-59`: **è€ƒè™‘ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—æœåŠ¡å¹¶æ£€æŸ¥æ•æ„Ÿæ•°æ®æ³„éœ²é£é™©ã€‚**

æ–°å¢çš„ `console.warn` è¯­å¥æœ‰åŠ©äºè°ƒè¯•ç¿»è¯‘å›é€€åœºæ™¯ï¼Œä½†éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **æ•æ„Ÿæ•°æ®é£é™©**ï¼š`issue` å¯¹è±¡å¯èƒ½åŒ…å«ç”¨æˆ·è¾“å…¥ã€éªŒè¯è·¯å¾„æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒè®°å½•è¿™äº›è¯¦ç»†ä¿¡æ¯å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ã€‚
2. **æ—¥å¿—åŸºç¡€è®¾æ–½**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—æœåŠ¡ï¼ˆå¦‚ Sentryã€Winston ç­‰ï¼‰è€Œä¸æ˜¯ `console.warn`ï¼Œä»¥ä¾¿æ›´å¥½åœ°è¿½è¸ªå’Œè¿‡æ»¤é”™è¯¯ã€‚
3. **ç¯å¢ƒæ„ŸçŸ¥**ï¼šè€ƒè™‘æ·»åŠ ç¯å¢ƒåˆ¤æ–­ï¼Œä»…åœ¨å¼€å‘æˆ–è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºè¯¦ç»†æ—¥å¿—ã€‚

å¦å¤–ï¼Œè¿™äº›æ—¥å¿—å˜æ›´ä¼¼ä¹ä¸ PR ä¸»é¢˜ï¼ˆæ¯æ—¥é€Ÿç‡é™åˆ¶åŠŸèƒ½ï¼‰æ— å…³ã€‚è¯·ç¡®è®¤è¿™äº›æ›´æ”¹æ˜¯å¦æœ‰æ„ä¸ºæ­¤ PR æ·»åŠ ï¼Œæˆ–è€…æ˜¯å¦åº”è¯¥åœ¨å•ç‹¬çš„ PR ä¸­å¤„ç†ã€‚




å¯é€‰çš„æ”¹è¿›ç¤ºä¾‹ï¼š

```diff
    try {
      return { message: t(code, params) };
    } catch (error) {
-     console.warn("setZodErrorMap fallback", { code, issue, error });
+     // Only log in development to avoid sensitive data exposure
+     if (process.env.NODE_ENV === 'development') {
+       console.warn("setZodErrorMap fallback", { code, error });
+       // Avoid logging the full issue object which may contain user input
+     }
      // Fallback to Zod default message
      return { message: _ctx.defaultError };
    }
```


Also applies to: 96-96

</blockquote></details>
<details>
<summary>messages/zh-CN/settings.json (1)</summary><blockquote>

`534-534`: **æ£€æŸ¥å ä½ç¬¦è¯­æ³•çš„ä¸€è‡´æ€§ã€‚**

Line 534 ä½¿ç”¨äº†ä¸¤ç§ä¸åŒçš„å ä½ç¬¦è¯­æ³•ï¼š`${amount}` å’Œ `{resetTime}`ã€‚å»ºè®®ç»Ÿä¸€ä½¿ç”¨ä¸€ç§æ ¼å¼ä»¥ä¿æŒä»£ç ä¸€è‡´æ€§ï¼Œé€šå¸¸æ¨èä½¿ç”¨ `{amount}` å’Œ `{resetTime}`ï¼ˆå•èŠ±æ‹¬å·ï¼‰ä»¥åŒ¹é…å…¶ä»– i18n æ¶ˆæ¯çš„æ¨¡å¼ã€‚



åº”ç”¨ä»¥ä¸‹ä¿®æ”¹ç»Ÿä¸€å ä½ç¬¦è¯­æ³•ï¼š

```diff
-            "daily": "æ—¥: ${amount} (é‡ç½® {resetTime})",
+            "daily": "æ—¥: {amount} (é‡ç½® {resetTime})",
```

</blockquote></details>
<details>
<summary>src/types/user.ts (1)</summary><blockquote>

`64-70`: **ä¸º UserKeyDisplay è¡¥å……å­—æ®µåœ¨ç±»å‹å±‚é¢æ˜¯æ­£ç¡®çš„**

- `limitDailyUsd: number | null` ä¸å…¶å®ƒé™é¢å­—æ®µé£æ ¼ä¸€è‡´ï¼Œå…è®¸â€œä¸è®¾ä¸Šé™â€ä¸º `null`ã€‚
- `dailyResetTime: string` ä¸æ•°æ®åº“é»˜è®¤ `'00:00'`ã€å‰ç«¯è¡¨å•é»˜è®¤å€¼ä¿æŒä¸€è‡´ï¼Œä¾¿äºåœ¨ UI ä¸­ç›´æ¥ä½¿ç”¨ã€‚

å¦‚æœåç»­æœ‰æ—¶é—´ï¼Œå¯ä»¥åœ¨æ¥å£æˆ–æ³¨é‡Šé‡Œæ˜ç¡®çº¦å®šæ ¼å¼ï¼ˆä¾‹å¦‚ `"HH:mm"`ã€ä½¿ç”¨ç³»ç»Ÿæ—¶åŒºï¼‰ï¼Œå‡å°‘è¯¯ç”¨ã€‚

</blockquote></details>
<details>
<summary>src/repository/_shared/transformers.ts (1)</summary><blockquote>

`24-37`: **Key/Provider è½¬æ¢ä¸­æ–°å¢æ—¥é™é¢å­—æ®µå®ç°åˆç†**

- `limitDailyUsd` ä½¿ç”¨ä¸ `limit5hUsd/limitWeeklyUsd/limitMonthlyUsd` ä¸€è‡´çš„ `parseFloat` é€»è¾‘ï¼Œä¿æŒè¡Œä¸ºç»Ÿä¸€ï¼ˆ`null/ç©º` è§†ä¸ºæœªé…ç½®ï¼‰ã€‚
- `dailyResetTime` ä½¿ç”¨ç©ºå€¼åˆå¹¶åˆ° `"00:00"`ï¼Œä¸æ•°æ®åº“è¿ç§»ä¸­çš„ `DEFAULT '00:00' NOT NULL` ç­–ç•¥ä¸€è‡´ï¼Œèƒ½é˜²å¾¡æ—§æ•°æ®ä¸­å¯èƒ½å‡ºç°çš„ç©ºå€¼ã€‚

å¦‚æœåç»­ `dailyResetTime` é»˜è®¤å€¼å¯èƒ½è°ƒæ•´ï¼ˆæ¯”å¦‚æ”¯æŒé…ç½®åŒ–ï¼‰ï¼Œå¯ä»¥è€ƒè™‘æŠŠ `"00:00"` æŠ½æˆå•ä¸€å¸¸é‡æˆ–å…±ç”¨è‡ª `time-utils` çš„å·¥å…·ï¼Œé¿å…æ•£è½å¤šå¤„éš¾ä»¥ç»Ÿä¸€ä¿®æ”¹ã€‚




Also applies to: 41-69

</blockquote></details>
<details>
<summary>src/app/[locale]/dashboard/quotas/keys/page.tsx (1)</summary><blockquote>

`21-24`: **Key é…é¢æ•°æ®å¢åŠ æ—¥é™é¢å­—æ®µçš„æ˜ å°„æ˜¯è¿è´¯çš„**

- `limitDailyUsd: key.limitDailyUsd ?? null` ä¸åç»­ `KeyWithQuota.limitDailyUsd: number | null` ç±»å‹å»åˆï¼Œå³ä¾¿ä¸Šæ¸¸ä¿è¯æ˜¯ `null` æˆ–æ•°å­—ï¼Œè¿™é‡ŒåŠ ä¸€å±‚å…œåº•ä¹Ÿæ— å®³ã€‚
- `dailyResetTime: key.dailyResetTime ?? "00:00"` ä¿è¯åœ¨ UI ä¾§å§‹ç»ˆæœ‰ä¸€ä¸ªæœ‰æ•ˆå­—ç¬¦ä¸²ä¼ å…¥ï¼Œä¾¿äºå€’è®¡æ—¶å’Œç¼–è¾‘å¯¹è¯æ¡†ä½¿ç”¨ã€‚

å”¯ä¸€çš„å°å»ºè®®æ˜¯ï¼šåœ¨ç¡®è®¤ä¸Šæ¸¸ç±»å‹å·²ç»ä¿è¯é `undefined` åï¼Œ`?? null` å¯ä»¥è§†æƒ…å†µç²¾ç®€ï¼›å½“å‰å®ç°ä¿æŒä¹Ÿå®Œå…¨æ²¡é—®é¢˜ã€‚

</blockquote></details>
<details>
<summary>src/app/[locale]/dashboard/quotas/keys/_components/keys-quota-client.tsx (1)</summary><blockquote>

`27-33`: **æ–°å¢æ¯æ—¥é…é¢åˆ—ä¸ç±»å‹æ‰©å±•æ•´ä½“å®ç°è‰¯å¥½ï¼Œéœ€è¦ä¿è¯ä¸Šæ¸¸æ€»æ˜¯æä¾› costDaily**

- `KeyQuota` å¢åŠ  `costDaily`ï¼ŒUI åœ¨ Daily åˆ—ä¸­ä½¿ç”¨å®ƒæ¥å±•ç¤ºå½“å‰/ä¸Šé™ã€è¿›åº¦æ¡å’Œå€’è®¡æ—¶ï¼Œé€»è¾‘ä¸ 5 å°æ—¶/å‘¨/æœˆå®Œå…¨å¯¹é½ï¼Œä¾¿äºåç»­ç»´æŠ¤ã€‚
- `KeyWithQuota` è¡¥å……äº† `limitDailyUsd` ä¸ `dailyResetTime`ï¼Œå¹¶å°† `dailyResetTime` é€ä¼ ç»™ `EditKeyQuotaDialog`ï¼Œä¸æ—¥é‡ç½®æ—¶é—´ç¼–è¾‘èƒ½åŠ›å¯¹é½ã€‚
- æ¸²æŸ“æ¡ä»¶ä¸º `hasKeyQuota && key.quota && key.quota.costDaily.limit !== null`ï¼Œä¾èµ– `key.quota.costDaily` å§‹ç»ˆå­˜åœ¨ï¼›å½“å‰ç±»å‹å®šä¹‰å·²çº¦æŸè¿™ä¸€ç‚¹ï¼Œä¸Šæ¸¸åœ¨æ„é€  `KeyQuota` æ—¶åŠ¡å¿…ç¡®ä¿æ€»æ˜¯æä¾› `costDaily: { current, limit, resetAt? }`ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶è§¦å‘ undefined è®¿é—®é”™è¯¯ã€‚

å¦‚æœåç»­æ‹…å¿ƒä¸Šæ¸¸æ•°æ®ä¸å®Œå…¨ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡Œå†åŠ ä¸€å±‚é˜²å¾¡æ€§åˆ¤æ–­ï¼ˆä¾‹å¦‚ `key.quota?.costDaily && key.quota.costDaily.limit !== null`ï¼‰ï¼Œä¸è¿‡åœ¨ç±»å‹ä¸¥æ ¼çš„å‰æä¸‹ç›®å‰å®ç°å·²ç»è¶³å¤Ÿã€‚




Also applies to: 40-48, 123-128, 185-217, 335-342

</blockquote></details>
<details>
<summary>src/app/[locale]/settings/providers/_components/forms/provider-form.tsx (1)</summary><blockquote>

`83-91`: **æ—¥é™é¢è¡¨å•æ¥çº¿å®Œæ•´ï¼Œå»ºè®®å¾®è°ƒæ‘˜è¦æ–‡æ¡ˆä¸é‡ç½®è¡Œä¸º**

æ•´ä½“æ¥çœ‹ï¼Œæ–°å¢çš„æ—¥é™é¢ç›¸å…³çŠ¶æ€ï¼ˆ`limitDailyUsd` / `dailyResetMode` / `dailyResetTime`ï¼‰ã€æäº¤ payload å­—æ®µä»¥åŠ UI æ§ä»¶éƒ½æ˜¯è¿é€šä¸”ä¸€è‡´çš„ï¼Œå’Œåç«¯ç±»å‹/éªŒè¯ä¿æŒäº†å¯¹é½ï¼Œè¿™å—å®ç°æ˜¯æ­£ç¡®çš„ã€‚

æœ‰ä¸¤ç‚¹å¯ä»¥è€ƒè™‘ä¼˜åŒ–ï¼š

1. **æŠ˜å æ‘˜è¦ä¸æ»šåŠ¨çª—å£æ¨¡å¼çš„è¯­ä¹‰**  
   - `sections.rateLimit.summary.daily` å½“å‰å§‹ç»ˆä½¿ç”¨ `resetTime: dailyResetTime` è¿›è¡Œå ä½ï¼Œå³ä¾¿åœ¨ `dailyResetMode === "rolling"` æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚
   - å¯¹ã€Œæ»šåŠ¨ 24h çª—å£ã€æ¥è¯´ï¼Œæ²¡æœ‰å›ºå®šé‡ç½®æ—¶é—´ï¼Œç»§ç»­å±•ç¤ºä¸€ä¸ªå…·ä½“æ—¶é—´ï¼ˆä¾‹å¦‚ `00:00`ï¼‰å¯èƒ½ä¼šè®©ç”¨æˆ·è¯¯è§£ä¸ºå›ºå®šç‚¹é‡ç½®ã€‚
   - å»ºè®® summary æ–‡æ¡ˆä¸­æ ¹æ® `dailyResetMode` é€‰æ‹©ä¸åŒçš„ç¿»è¯‘ keyï¼Œæˆ–åœ¨ `rolling` æ¨¡å¼ä¸‹ä¸å±•ç¤º `resetTime`ï¼Œè€Œæ˜¯æ”¹ä¸ºè¯¸å¦‚ã€Œæ»šåŠ¨ 24 å°æ—¶çª—å£ã€ã€‚

2. **åˆ›å»ºæˆåŠŸåçš„é‡ç½®è¡Œä¸º**  
   - æ–°å»ºå®Œæˆåå·²å°† `limitDailyUsd` ç½®ä¸º `null`ï¼Œ`dailyResetTime` é‡ç½®ä¸º `"00:00"`ï¼Œä½† `dailyResetMode` æ²¡æœ‰é‡ç½®ï¼Œä»ä¿ç•™ä¸Šä¸€æ¬¡åˆ›å»ºæ—¶çš„é€‰æ‹©ã€‚
   - å¯¹æ¯”å…¶å®ƒå­—æ®µï¼ˆæ¯”å¦‚ `providerType` è¢«é‡ç½®å› `"claude"`ï¼‰ï¼Œè¿™é‡Œçš„è¡Œä¸ºç•¥ä¸ä¸€è‡´ã€‚å¦‚æœå¸Œæœ›ã€Œæ–°å¢åå›åˆ°é»˜è®¤è¡¨å•çŠ¶æ€ã€ï¼Œå¯ä»¥åœ¨ reset æ®µå¢åŠ  `setDailyResetMode("fixed")`ï¼›å¦‚æœåˆ»æ„å¸Œæœ›æ²¿ç”¨ä¸Šä¸€æ¬¡é€‰æ‹©ï¼Œåˆ™å¯ä»¥åœ¨æ³¨é‡Šä¸­è¯´æ˜è®¾è®¡æ„å›¾ä»¥å…åç»­ç»´æŠ¤è€…å›°æƒ‘ã€‚





Also applies to: 218-266, 292-310, 347-350, 730-807, 809-853

</blockquote></details>
<details>
<summary>src/actions/keys.ts (1)</summary><blockquote>

`24-36`: **æ–°å¢ daily å­—æ®µçš„æ•´ä½“é“¾è·¯æ²¡é—®é¢˜ï¼Œä½† editKey å¯èƒ½æ— æ„è¦†ç›– daily_reset_mode**

åç«¯æ–°å¢çš„ `limitDailyUsd` / `dailyResetTime` ä»å‚æ•° â†’ `KeyFormSchema` â†’ `createKey` / `updateKey` çš„ä¼ é€’æ˜¯è¿è´¯çš„ï¼Œè¿™ç‚¹ä¸é”™ã€‚ä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªå®¹æ˜“è¸©å‘çš„ç‚¹ï¼š

- `editKey` çš„ `data` å½¢çŠ¶é‡Œæ²¡æœ‰ `dailyResetMode` å­—æ®µï¼Œä½† `KeyFormSchema.parse(data)` ä¹‹ååˆæŠŠ `validatedData.dailyResetMode` å†™å›åˆ° `updateKey` çš„ payload ä¸­ã€‚
- å¦‚æœéªŒè¯ schema å¯¹ `dailyResetMode` é…ç½®äº†é»˜è®¤å€¼ï¼ˆä¾‹å¦‚ `"fixed"`ï¼‰ï¼Œé‚£ä¹ˆ**æ¯æ¬¡ç¼–è¾‘ Keyï¼ˆå“ªæ€•å‰ç«¯å®Œå…¨æ²¡åŠ¨æ—¥é™é¢æ¨¡å¼ï¼‰ä¹Ÿä¼šæŠŠæ•°æ®åº“é‡Œçš„ `daily_reset_mode` é‡ç½®ä¸ºé»˜è®¤å€¼**ã€‚

å»ºè®®ï¼š

- è‹¥æš‚æ—¶ä¸æ‰“ç®—åœ¨ UI æš´éœ² daily æ¨¡å¼åˆ‡æ¢ï¼Œå¯ä»¥åœ¨ `editKey` ä¸­ä»…åœ¨ã€Œè°ƒç”¨æ–¹æ˜¾å¼ä¼ å…¥ dailyResetModeã€çš„æƒ…å†µä¸‹æ‰æŠŠå®ƒå†™å…¥ `updateKey`ï¼Œå¦åˆ™ä¿ç•™æ•°æ®åº“åŸå€¼ï¼ˆä¾‹å¦‚åœ¨æ„é€  payload å‰ä» `data` / `validatedData` ä¸­åˆ é™¤æœªæ˜¾å¼ä¼ å…¥çš„ `dailyResetMode` å­—æ®µï¼‰ã€‚
- æˆ–è€…åç»­å‡†å¤‡æ”¯æŒ rolling æ¨¡å¼æ—¶ï¼Œä¸€å¹¶åœ¨ EditKeyForm ä¸­å¢åŠ æ¨¡å¼é€‰æ‹©æ§ä»¶ï¼Œä¸è¿™é‡Œçš„å­—æ®µå¯¹é½ã€‚

è¿™æ ·å¯ä»¥é¿å…åç»­å¼€å¯ rolling æ¨¡å¼åï¼Œè¢«ä»»æ„ä¸€æ¬¡ Key ç¼–è¾‘æ‚„æ‚„æ”¹å› fixedã€‚  



Also applies to: 47-58, 75-89, 102-115, 133-150

</blockquote></details>
<details>
<summary>src/app/[locale]/dashboard/_components/user/forms/edit-key-form.tsx (1)</summary><blockquote>

`14-26`: **å‰ç«¯è¡¨å•å¯¹æ¥ limitDailyUsd / dailyResetTime è¾ƒä¸ºå®Œæ•´ï¼Œå¯ä½œä¸ºåç»­æ‰©å±•åŸºç¡€**

- `EditKeyFormProps`ã€`defaultValues` ä»¥åŠæäº¤ payload éƒ½æ­£ç¡®åœ°ä¸²è”äº† `limitDailyUsd` å’Œ `dailyResetTime`ï¼Œä¸åç«¯ `KeyFormSchema` / `editKey` çš„å­—æ®µå‘½åä¿æŒä¸€è‡´ã€‚
- ä½¿ç”¨ `<TextField type="time" step={60} />` æ­é…é»˜è®¤å€¼ `"00:00"`ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°çº¦æŸä¸º `"HH:mm"` å½¢æ€ï¼Œæ–¹ä¾¿åç«¯ `normalizeResetTime` å¤„ç†ã€‚

ç›®å‰è¡¨å•ä¸æš´éœ² `dailyResetMode`ï¼Œåœ¨åªæ”¯æŒå›ºå®šæ¯æ—¥çª—å£çš„é˜¶æ®µå¯ä»¥æ¥å—ã€‚è‹¥ä¹‹åæ‰“å¼€ rolling æ¨¡å¼ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ–°å¢ä¸€ä¸ªæ¨¡å¼é€‰æ‹©ï¼ˆä¾‹å¦‚å•é€‰æŒ‰é’®ï¼‰ï¼Œå¹¶ä¸åç«¯çš„ `dailyResetMode` å­—æ®µè”åŠ¨ã€‚  




Also applies to: 44-56, 62-74, 133-158

</blockquote></details>
<details>
<summary>src/lib/rate-limit/time-utils.ts (1)</summary><blockquote>

`6-21`: **daily æ—¶é—´çª—å£ä¸ TTL è®¡ç®—å®ç°åˆç†ï¼Œå¯æ³¨æ„ä¸‹æ¸¸å¯¹ ResetInfo.type çš„è¦†ç›–**

è¿™é‡Œå¯¹æ—¶é—´å·¥å…·çš„æ‰©å±•æ•´ä½“æ¯”è¾ƒæ‰å®ï¼š

- `TimePeriod` å¢åŠ  `"daily"`ï¼Œå¹¶é’ˆå¯¹ dailyï¼š
  - fixed æ¨¡å¼ä½¿ç”¨ `normalizeResetTime` + `getCustomDailyResetTime` / `getNextDailyResetTime`ï¼Œç»“åˆ `TZ` æ—¶åŒºï¼Œç¡®ä¿ã€Œæœ¬åœ°é…ç½®æ—¶åŒº + è‡ªå®šä¹‰ HH:mmã€çš„çª—å£æ­£ç¡®ã€‚
  - rolling æ¨¡å¼é€šè¿‡ `getTimeRangeForPeriodWithMode` / `getTTLForPeriodWithMode` è¿”å› 24 å°æ—¶æ»‘åŠ¨çª—å£ï¼Œè¯­ä¹‰æ¸…æ™°ã€‚
- `parseResetTime` å’Œ `normalizeResetTime` å¯¹éæ³•è¾“å…¥éƒ½å®‰å…¨å›é€€åˆ° `"00:00"`ï¼Œé¿å…å¼‚å¸¸æŠ›å‡ºã€‚
- `ResetInfo` æ–°å¢ `"custom"` ç±»å‹åŒºåˆ† daily fixedï¼Œä¸åŸæ¥çš„ `"rolling"` / `"natural"` æ›´æ¸…æ™°ã€‚

éœ€è¦ç•™æ„çš„ä¸€ç‚¹æ˜¯ï¼šç°åœ¨ `ResetInfo["type"]` å˜ä¸º `"rolling" | "natural" | "custom"`ï¼Œå¦‚æœå…¶ä»–åœ°æ–¹ä¹‹å‰å¯¹ `type` åšäº†ç©·ä¸¾åˆ¤æ–­ï¼ˆåªå¤„ç† rolling/naturalï¼‰ï¼Œéœ€è¦è®°å¾—è¡¥ä¸Š `"custom"` åˆ†æ”¯ï¼Œå¦åˆ™åœ¨ TS å±‚é¢å¯èƒ½ä¼šæœ‰ç±»å‹å‘Šè­¦ã€‚æ•´ä½“ä¸Šè¿™éƒ¨åˆ†å®ç°å¯ä»¥æ”¯æ’‘åç»­ daily é™é¢çš„å„ç§æ¨¡å¼ã€‚  




Also applies to: 28-32, 43-80, 82-105, 113-147, 149-166, 170-214, 216-289

</blockquote></details>
<details>
<summary>src/lib/rate-limit/service.ts (1)</summary><blockquote>

`12-28`: **RateLimitService çš„ daily é™æµå®ç°æ•´ä½“ä¸€è‡´ï¼Œå…³é”®åœ¨äºè°ƒç”¨æ–¹æ­£ç¡®ä¼ å…¥ resetTime/resetMode**

è¿™éƒ¨åˆ†å¯¹ daily é™é¢çš„æ”¯æŒä» Redis key å‘½åã€TTL åˆ° DB é™çº§é€»è¾‘æ•´ä½“æ˜¯è‡ªæ´½çš„ï¼š

- 5h ä¸ daily rollingï¼š
  - éƒ½ä½¿ç”¨ ZSET + Luaï¼ˆ`TRACK_COST_5H_ROLLING_WINDOW` / `TRACK_COST_DAILY_ROLLING_WINDOW` + å¯¹åº” GET è„šæœ¬ï¼‰ï¼Œwindow åˆ†åˆ«å›ºå®šä¸º 5 å°æ—¶ / 24 å°æ—¶ã€‚
  - cache miss æ—¶ä¼šæ£€æµ‹ key æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨æ‰å›é€€åˆ°æ•°æ®åº“å¹¶è¿›è¡Œ cache warmingã€‚
- daily fixed / weekly / monthlyï¼š
  - é€šè¿‡ `resolveDailyReset` å¾—åˆ°å½’ä¸€åŒ–æ—¶é—´å’Œåç¼€ï¼ˆå¦‚ `"08:30"` â†’ `"0830"`ï¼‰ï¼Œæ„é€  `cost_daily_0830` ç­‰ keyï¼Œå¹¶ä½¿ç”¨ `getTTLForPeriodWithMode` æ¥è®¡ç®— TTLï¼Œä¿è¯ DB é™çº§å’Œæ­£å¸¸è¯·æ±‚è·¯å¾„çš„çª—å£è¾¹ç•Œä¸€è‡´ã€‚
- `checkCostLimitsFromDatabase` å’Œ `getCurrentCost` åœ¨é™çº§æ—¶å‡ä½¿ç”¨ `getTimeRangeForPeriodWithMode` ä¸ `getTTLForPeriodWithMode`ï¼Œrolling/fixed ä¸¤ç§æ¨¡å¼çš„æ—¶é—´èŒƒå›´å’Œ TTL ç®—æ³•ä¿æŒç»Ÿä¸€ã€‚
- ç”¨æˆ·æ¯æ—¥é¢åº¦æ£€æŸ¥/è¿½è¸ªè¿ç§»åˆ° `getSecondsUntilMidnight`ï¼Œä¸å…¨å±€ TZ é…ç½®å¯¹é½ã€‚

ç›®å‰çœŸæ­£éœ€è¦å°å¿ƒçš„æ˜¯**è°ƒç”¨æ–¹æ˜¯å¦ä¼ å…¥äº†æ­£ç¡®çš„ `daily_reset_time` å’Œ `daily_reset_mode`**ï¼šå¦‚æœåƒ `getKeyLimitUsage` / `getProviderLimitUsage` é‚£æ ·çœç•¥äº†æ¨¡å¼å‚æ•°ï¼Œå°±ä¼šé€€å›é»˜è®¤ `"fixed"`ï¼Œrolling æ¨¡å¼é€»è¾‘åœ¨å±•ç¤ºå±‚å½¢åŒæœªå¯ç”¨ã€‚è°ƒç”¨ç‚¹åœ¨ actions å±‚å·²å•ç‹¬æŒ‡å‡ºå¹¶ç»™å‡ºä¿®æ­£å»ºè®®ï¼ŒRateLimitService æœ¬èº«çš„è®¾è®¡å¯ä»¥æ”¯æŒè¿™ä¸¤ç§æ¨¡å¼ã€‚  